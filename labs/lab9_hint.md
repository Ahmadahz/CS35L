# Lab
1. Get a copy of the Diffutils repository, in Git format, from the file ~eggert/src/gnu/diffutils on the SEASnet GNU/Linux servers, or from its main Savannah repository.
```
[~]> git clone https://git.savannah.gnu.org/git/diffutils.git
```
2. Get a log of changes to Diffutils’ master branch using the “git log” command, and put it into the file git-log.txt.
```
[~]> cd diffutils
[~/diffutils]> git log > ../git-log.txt
```
3. Generate a list of tags used for Diffutils using the “git tag” command, and put it into the file git-tags.txt
```
[~/diffutils]> git tag > ../git-tags.txt
```
4. Find the commit entitled “maint: quote 'like this' or "like this", not `like this'”, and generate a patch for that commit, putting it into the file quote-patch.txt.
```
[~/diffutils]> git log --grep="maint: quote" | grep commit
commit 62ca21c8c1a5aa3488589dcb191a4ef04ae9ed4f
[~/diffutils]> git show 62ca21c8c1a5aa3488589dcb191a4ef04ae9ed4f > ../quote_patch.txt
```
5. Check out version 3.0 of Diffutils from your repository.
```
[~/diffutils]> git checkout v3.0
```
6. Use the patch command to apply quote-patch.txt to version 3.0. In some cases it will not be able to figure out what file to patch; skip past those by typing RETURN. Record any problems you had in applying the patch.
```
[~/diffutils]> patch -p1 < ../quote_patch.txt
```
7. Use the git status command to get an overview of what happened.
```
[~/diffutils]> git status
```
8. Learn how to use the Emacs functions vc-diff (C-x v =) and vc-revert (C-x v u). When you're in the *vc-diff* buffer generated by vc-diff, use describe-mode (C-h m) to find out the Emacs functions that you can use there, and in particular learn how to use the diff-apply-hunk (C-c C-a) and diff-goto-source (C-c C-c) functions.
```
just learn how to use vc-diff, vc-revert, and diff-apply-hunk
```
9. Use Emacs to revert all the changes to files other than .c files, since you want only changes to .c files. Also, and don't forget this part, undo all the changes to .c files other than changes to character string constants, as the character-string changes are the only changes that you want; this may require editing some files by hand.
```
use vc-diff, vc-revert, or diff-apply-hunk
```
10. Use Emacs to examine the files src/*.c.rej carefully, and copy rejected patches into the corresponding .c files as needed.
```
use vc-diff, vc-revert, or diff-apply-hunk
```
11. Remove all untracked files that git status warns you about, since you don’t plan on adding any files in your patch.
```
[~/diffutils]> git clean -f 
```
12. When you’re done with the above, git status should report a half-dozen modified files, and git diff should output a patch that is three or four hundred lines long. Put that patch into a file quote-3.0-patch.txt.
```
[~/diffutils]> git diff > ../quote-3.0-patch.txt
```
13. Build the resulting modified version of Diffutils, using the commands described in the file README-hacking, 
skipping the part about CVS; CVS is obsolescent. (If you are building on lnxsrv07 or lnxsrv09 or any other host 
that is using version 2.16 or later of the GNU C Library, you will need to apply an additional patch 
after running ./bootstrap and before running ./configure, because glibc 2.16 removed the obsolete and 
dangerous gets function declared by a Diffutils header.) Verify that Diffutils does the right thing with 
the “diff . -” scenario, as well as with “diff --help”.
```
# read README-hacking and you can find these commands
[~/diffutils]> ./bootstrap

# switch to lnxsrv05 so that you dont need to deal with the `gets` issue
# or patch diffutils-gets.diff after running ./bootstrap and before running ./configure
[~/diffutils]> curl http://web.cs.ucla.edu/classes/winter18/cs35L/assign/diffutils-gets.diff > ../diffutils-gets.diff
[~/diffutils]> patch -p0 < ../diffutils-gets.diff

[~/diffutils]> ./configure
[~/diffutils]> make
[~/diffutils]> make check

# try to run diff
[~/diffutils]> ./src/diff . -
[~/diffutils]> ./src/diff --help
```
14. Do a sanity test using the modified version of Diffutils that you just built, 
by using the just-built diff to compare the source code of Diffutils 3.0 to the source code of your modified version. 
Put the former source code into a directory diffutils-3.0 and the latter source code into a directory diffutils-3.0-patch, 
and run your implementation of diff with the command “D/diff -pru diffutils-3.0 diffutils-3.0-patch >quote-3.0-test.txt”, 
where the D is the directory containing your diff implementation.
```
# get the source code of Diffutils 3.0
[~/diffutils]> cd ..
[~]> git clone https://git.savannah.gnu.org/git/diffutils.git diffutils-3.0
[~]> cd diffutils-3.0
[~/diffutils-3.0]> git checkout 'v3.0'

# put your modified version in diffutils-3.0-patch
[~/diffutils-3.0]> cd ..
[~]> mkdir diffutils-3.0-patch
[~]> cp ./diffutils/src/*.c ./diffutils-3.0-patch/

# compare
[~]> ./diffutils/src/diff -pru diffutils-3.0 diffutils-3.0-patch > quote-3.0-test.txt
```
15. Use diff to compare the contents of quote-3.0-test.txt and quote-3.0-patch.txt. Are the files identical? If not, are the differences innocuous?
```
[~]> diff -u quote-3.0-test.txt quote-3.0-patch.txt
```

# Homework
1. Check out version 3.0 of Diffutils from your repository, into a new branch named “quote”.
```
[~] cd diffutils
[~/diffutils] git checkout v3.0 -b quote
```
2. Install your change into this new branch, by running the patch command with your patch quote-3.0-patch.txt as input.
```
[~/diffutils] patch -p1 < ../quote-3.0-patch.txt
```
3. Learn how to use the Emacs function add-change-log-entry-other-window (C-x 4 a).
4. Use this Emacs function to compose an appropriate ChangeLog entry for your patch, by adapting the change log from the original patch.
5. Commit your changes to the new branch, using the ChangeLog entry as the commit message.
```
[~/diffutils] git add .
[~/diffutils] git commit -F Changelog
```
6. Use the command “git format-patch” to generate a file formatted-patch.txt. This patch should work without having to fix things by hand afterwards.
```
[~/diffutils] git format-patch -1 --stdout > formatted-patch.txt
```
7. Your teaching assistant will assign you a partner, who will also generate a patch. Verify that your partner's patch works, by checking out version 3.0 again into a new temporary branch partner, applying the patch with the command “git am”, and building the resulting system, checking that it works with “make check”.
```
[~/diffutils] git checkout v3.0 -b partner

# get partner-patch.txt via any method (scp, google drive, messenger, etc)

[~/diffutils] git am < ../partner-patch.txt
```
8. Verify that your ChangeLog entry works, by running the command “make distdir” and inspecting the resulting diffutils*/ChangeLog file.
```
[~/diffutils] ./bootstrap
[~/diffutils] ./configure
[~/diffutils] make
[~/diffutils] make check
[~/diffutils] make distdir
```
9. There is a copy of the GNU Emacs git repository's master branch on SEASnet in the directory ~eggert/src/gnu/emacs. Run the command gitk on it, and find the newest merge that is not newer than 2015-01-25. Take a screenshot gitk-screenshot.png of your view of the mergepoint, and in an ASCII text file gitk-description.txt briefly describe the roles of subwindows that you see in the screenshot.
```
ssh -Y yourid@yourseasnetserver
cd ~eggert/src/gnu/emacs
gitk
```
